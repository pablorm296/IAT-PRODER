function randomInt(e,a){return e=Math.ceil(e),a=Math.floor(a),Math.floor(Math.random()*(a-e+1))+e}function keyHandler(e,a=!1,r){var t;window.event?t=e.keyCode:e.which&&(t=e.which);var n=String.fromCharCode(t);if(" "===n&&(n="space"),a&&console.log("Key pressed:"+n),!r)return n;r(n)}function keyCallBack(e){if(__instructions)"space"==e&&(myAPI.endPoints.GET_stimuli(__stage),__instructions=!1,$("#space_bar").hide(),$("#instructions").hide(),$("#rndCount").hide());else{if("space"==e)return!1;"e"==e&&iatAnswer(e),"i"==e&&iatAnswer(e)}}function iatAnswer(e){const a=__trialCount+1,r=`#stimHolder_${a}`,t=$(r).attr("label");if("e"==e)if(__left.includes(t)){const e=getLatency();saveTrial(e),console.log(`correcto (${e} ms)`),hideText("info"),__trialCount+=1,playIAT()}else console.log("incorrecto"),__errorCnt+=1,showError();else if(__right.includes(t)){const e=getLatency();saveTrial(e),console.log(`correcto (${e} ms)`),hideText("info"),__trialCount+=1,playIAT()}else console.log("incorrecto"),__errorCnt+=1,showError()}function getLatency(){const e=new Date,a=Math.abs(e-__trialStart);return a}function saveTrial(e){const a=__trialCount+1,r=`#stimHolder_${a}`,t=$(r).attr("label"),n=$(r).attr("type"),s=$(r).attr("val"),o=__errorCnt,i={latency:e,type:n,label:t,value:s,error:o};__results[`round_${__stage}`].push(i)}function showError(){var e=$("#errorMrk"),a=$("#errorMsg");e.show(),a.show()}function assignLabelsAndText(e,a){var r=$("#leftColTxt"),t=$("#rightColTxt"),n=r.children("span")[0],s=r.children("span")[1],o=r.children("span")[2],i=t.children("span")[0],l=t.children("span")[1],_=t.children("span")[2],c=__order;a&&(0===c?c=1:1===c&&(c=0));const d=0===c?1:-1,u=0===__order?1:-1;if("word&img"==e){const e=`En este bloque tendrás que clasificar palabras e imágenes.<br>La columna izquierda corresponde a personas de ${__imgCatInstructions[__order]} y palabras ${__wrdCatInstructions[c]}, mientras que la columna derecha corresponde a personas ${__imgCatInstructions[__order+1*u]} y palabras ${__wrdCatInstructions[c+1*d]}. Recuerda que tienes que usar las <span>teclas "E" e "I"</span> para asignar la palabra o imagen a la columna correspondiente.`;__left=[__wrdLabel[c],__imgLabel[__order]],__right=[__wrdLabel[c+1*d],__imgLabel[__order+1*u]],n.innerText=__imgCat[__order],i.innerText=__imgCat[__order+1*u],o.innerText=__wrdCat[c],_.innerText=__wrdCat[c+1*d],n.style.display="block",s.style.display="block",o.style.display="block",i.style.display="block",l.style.display="block",_.style.display="block",$("#instructions").html(e)}else if("word"==e){const e=`En este bloque tendrás que clasificar palabras.<br>La columna izquierda corresponde a palabras ${__wrdCatInstructions[c]}, mientras que la columna derecha corresponde a palabras ${__wrdCatInstructions[c+1*d]}. Recuerda que tienes que usar <span>teclas "E" e "I"</span> para asignar la palabra a la columna correspondiente.`;__left=[__wrdLabel[c]],__right=[__wrdLabel[c+1*d]],o.innerText=__wrdCat[c],_.innerText=__wrdCat[c+1*d],o.style.display="block",_.style.display="block",$("#instructions").html(e)}else{if("img"!=e)throw"Invalid stageType";{const e=`En este bloque tendrás que clasificar imágenes.<br>La columna izquierda corresponde a personas de ${__imgCatInstructions[__order]}, mientras que la columna derecha corresponde a personas ${__imgCatInstructions[__order+1*u]}. Recuerda que tienes que usar <span>teclas "E" e "I"</span> para asignar la imagen a la columna correspondiente.`;__left=[__imgLabel[__order]],__right=[__imgLabel[__order+1*u]],n.innerText=__imgCat[__order],i.innerText=__imgCat[__order+1*u],n.style.display="block",i.style.display="block",$("#instructions").html(e)}}}function hideText(e){var a=$("#leftColTxt"),r=$("#rightColTxt"),t=a.children("span")[0],n=a.children("span")[1],s=a.children("span")[2],o=r.children("span")[0],i=r.children("span")[1],l=r.children("span")[2],_=$("#rndCount"),c=$("#errorMrk"),d=$("#errorMsg");switch(e){case"columns":t.style.display="none",o.style.display="none",n.style.display="none",i.style.display="none",s.style.display="none",l.style.display="none";break;case"info":_.hide(),c.hide(),d.hide()}}function showInstructions(){switch(__instructions=!0,$("#space_bar").text("Presiona la barra espaciadora para comenzar"),__stage){case 1:assignLabelsAndText("word",!1);break;case 2:assignLabelsAndText("img",!1);break;case 3:case 4:assignLabelsAndText("word&img",!1);break;case 5:assignLabelsAndText("word",!0),$("#instructions").append("<br><span>¡Ojo! el orden de las categorías (columnas) cambió de posición.</span>");break;case 6:case 7:assignLabelsAndText("word&img",!0)}$("#space_bar").show(),$("#instructions").show(),$("#rndCount").show()}function placeStimuli(e){__stageLength=e.length;for(let a=0;a<e.length;a++){const r=a+1,t=`#stimHolder_${r}`,n=e[a],s=n.type,o=n.label,i=n.content;$(t).hide(),"img"==s?$(t).html(`<img src='../imgs/stimuli/${i}.jpg'>`):$(t).html(i),$(t).attr("label",o),$(t).attr("type",s),$(t).attr("val",i),$(".stimuli").imagesLoaded(function(){$("#loader").hide(),__trialCount=0,playIAT()})}}function playIAT(){const e=__trialCount+1;__trialCount<__stageLength?(0!=__trialCount&&$(`#stimHolder_${e-1}`).hide(),$(`#stimHolder_${e}`).show(),__trialStart=new Date,__errorCnt=0):($(`#stimHolder_${e-1}`).hide(),__stage+=1,IATloop())}function IATloop(){if($("#loader").hide(),__stage>7){const e={results:__results,order:__order};myAPI.endPoints.POST_results(e),window.location.href="/IAT/static/src/survey.php"}else 1==__stage&&(__order=randomInt(0,1));var e=[];__results[`round_${__stage}`]=e,$("#rndCount").text(`Ronda ${__stage} de 7`),hideText("columns"),hideText("info"),showInstructions()}var __order,__trialCount,__stageLength,__trialStart,__left,__right,myAPI,__stage=1,__imgCat=["Piel clara","Piel oscura"],__imgCatInstructions=["piel clara","piel oscura"],__wrdCat=["Bueno","Malo"],__wrdCatInstructions=["palabras buenas","palabras malas"],__imgLabel=["white","dark"],__wrdLabel=["good","bad"],__instructions=!1,__results={},__errorCnt=0;$(document).ready(function(){$(window).height(),$(window).width();$("html,body").scrollTop(0),IATloop(),$(document).keypress(function(e){e.preventDefault(),keyHandler(e,!1,keyCallBack)})});