function randomInt(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}function keyHandler(e,t=!1,n){var l;window.event?l=e.keyCode:e.which&&(l=e.which);var s=String.fromCharCode(l);if(" "===s&&(s="space"),t&&console.log("Key pressed:"+s),!n)return s;n(s)}function keyCallBack(e){if(__instructions)"space"==e&&(myAPI.endPoints.GET_stimuli(__stage),__instructions=!1);else{if("space"==e)return!1;"e"==e&&iatAnswer(e),"i"==e&&iatAnswer(e)}}function iatAnswer(e){const t=__trialCount+1,n=`#stimHolder_${t}`,l=$(n).attr("label");if("e"==e)if(__left.includes(l)){const e=getLatency();saveTrial(e),console.log(`correcto (${e} ms)`),hideText("info"),__trialCount+=1,playIAT()}else console.log("incorrecto"),showError();else if(__right.includes(l)){const e=getLatency();saveTrial(e),console.log(`correcto (${e} ms)`),hideText("info"),__trialCount+=1,playIAT()}else console.log("incorrecto"),showError()}function getLatency(){const e=new Date,t=Math.abs(e-__trialStart);return t}function saveTrial(e){const t=__trialCount+1,n=`#stimHolder_${t}`,l=$(n).attr("label"),s=$(n).attr("type"),a=$(n).attr("val"),r={latency:e,type:s,label:l,value:a};__results[`round_${__stage}`].push(r)}function showError(){var e=$("#errorMrk"),t=$("#errorMsg");e.show(),t.show()}function assignLabelsAndText(e,t){var n=$("#leftColTxt"),l=$("#rightColTxt"),s=n.children("span")[0],a=n.children("span")[1],r=n.children("span")[2],i=l.children("span")[0],o=l.children("span")[1],_=l.children("span")[2],d=__order;t&&(0===d?d=1:1===d&&(d=0));const c=0===d?1:-1;if("word&img"==e)__left=[__wrdLabel[d],__imgLabel[d]],__right=[__wrdLabel[d+1*c],__imgLabel[d+1*c]],s.innerText=__imgCat[d],i.innerText=__imgCat[d+1*c],r.innerText=__wrdCat[d],_.innerText=__wrdCat[d+1*c],s.style.display="block",a.style.display="block",r.style.display="block",i.style.display="block",o.style.display="block",_.style.display="block";else if("word"==e)__left=[__wrdLabel[d]],__right=[__wrdLabel[d+1*c]],r.innerText=__wrdCat[d],_.innerText=__wrdCat[d+1*c],r.style.display="block",_.style.display="block";else{if("img"!=e)throw"Invalid stageType";__left=[__imgLabel[d]],__right=[__imgLabel[d+1*c]],s.innerText=__imgCat[d],i.innerText=__imgCat[d+1*c],s.style.display="block",i.style.display="block"}}function hideText(e){var t=$("#leftColTxt"),n=$("#rightColTxt"),l=t.children("span")[0],s=t.children("span")[1],a=t.children("span")[2],r=n.children("span")[0],i=n.children("span")[1],o=n.children("span")[2],_=$("#rndCount"),d=$("#errorMrk"),c=$("#errorMsg");switch(e){case"columns":l.style.display="none",r.style.display="none",s.style.display="none",i.style.display="none",a.style.display="none",o.style.display="none";break;case"info":_.hide(),d.hide(),c.hide()}}function showInstructions(){switch(__instructions=!0,__stage){case 1:assignLabelsAndText("word",!1);break;case 2:assignLabelsAndText("img",!1);break;case 3:case 4:assignLabelsAndText("word&img",!1);break;case 5:assignLabelsAndText("word",!0);break;case 6:case 7:assignLabelsAndText("word&img",!0)}}function placeStimuli(e){__stageLength=e.length;for(let t=0;t<e.length;t++){const n=t+1,l=`#stimHolder_${n}`,s=e[t],a=s.type,r=s.label,i=s.content;$(l).hide(),"img"==a?$(l).html(`<img src='../imgs/stimuli/${i}.jpg'>`):$(l).html(i),$(l).attr("label",r),$(l).attr("type",a),$(l).attr("val",i),$(".stimuli").imagesLoaded(function(){$("#loader").hide(),__trialCount=0,playIAT()})}}function playIAT(){const e=__trialCount+1;__trialCount<__stageLength?(0!=__trialCount&&$(`#stimHolder_${e-1}`).hide(),$(`#stimHolder_${e}`).show(),__trialStart=new Date):($(`#stimHolder_${e-1}`).hide(),__stage+=1,IATloop())}function IATloop(){if($("#loader").hide(),__stage>7){const e={results:__results,order:__order};myAPI.endPoints.POST_results(e)}else 1==__stage&&(__order=randomInt(0,1));var e=[];__results[`round_${__stage}`]=e,$("#rndCount").text(`Ronda ${__stage} de 7`),hideText("columns"),hideText("info"),showInstructions()}var __order,__trialCount,__stageLength,__trialStart,__left,__right,myAPI,__stage=1,__imgCat=["Piel clara","Piel oscura"],__wrdCat=["Bueno","Malo"],__imgLabel=["white","dark"],__wrdLabel=["good","bad"],__instructions=!1,__results={};$(document).ready(function(){$(window).height(),$(window).width();$("html,body").scrollTop(0),IATloop(),$(document).keypress(function(e){e.preventDefault(),keyHandler(e,!1,keyCallBack)})});