function randomInt(e,a){return e=Math.ceil(e),a=Math.floor(a),Math.floor(Math.random()*(a-e+1))+e}function keyHandler(e,a=!1,t){var r;window.event?r=e.keyCode:e.which&&(r=e.which);var n=String.fromCharCode(r);if(" "===n&&(n="space"),a&&console.log("Key pressed:"+n),!t)return n;t(n)}function keyCallBack(e){if(__instructions)"space"==e&&($("#loader").show(),myAPI.endPoints.GET_stimuli(__stage,placeStimuli),__instructions=!1,screenfull.isFullscreen?console.log("La pantalla ya está maximizada"):screenfull.request(),$("#space_bar").hide(),$("#instructions").hide(),$("#rndCount").hide(),$("#blank").removeClass("blank"),$("#blank").addClass("blank_bigger"));else{if("space"==e)return!1;"e"==e&&iatAnswer(e),"i"==e&&iatAnswer(e)}}function iatAnswer(e){const a=__trialCount+1,t=`#stimHolder_${a}`,r=$(t).attr("label");if("e"==e)if(__left.includes(r)){const e=getLatency();saveTrial(e),console.log(`correcto (${e} ms)`),hideText("info"),__trialCount+=1,playIAT()}else console.log("incorrecto"),__errorCnt+=1,showError();else if(__right.includes(r)){const e=getLatency();saveTrial(e),console.log(`correcto (${e} ms)`),hideText("info"),__trialCount+=1,playIAT()}else console.log("incorrecto"),__errorCnt+=1,showError()}function getLatency(){const e=new Date,a=Math.abs(e-__trialStart);return a}function saveTrial(e){const a=__trialCount+1,t=`#stimHolder_${a}`,r=$(t).attr("label"),n=$(t).attr("type"),s=$(t).attr("val"),l=__errorCnt,o={latency:e,type:n,label:r,value:s,error:l};__results[`round_${__stage}`].push(o)}function showError(){var e=$("#errorMrk"),a=$("#errorMsg");e.show(),a.show()}function assignLabelsAndText(e,a,t,r){var n=$("#leftColTxt"),s=$("#rightColTxt"),l=n.children("span")[0],o=n.children("span")[1],i=n.children("span")[2],c=s.children("span")[0],_=s.children("span")[1],d=s.children("span")[2],u=__order;r&&(0===u?u=1:1===u&&(u=0));const p=0===u?1:-1,g=0===__order?1:-1;if("word&img"==e){const e=a;__left=[__wrdLabel[u],__imgLabel[__order]],__right=[__wrdLabel[u+1*p],__imgLabel[__order+1*g]],l.innerText=__imgCat[__order],c.innerText=__imgCat[__order+1*g],i.innerText=__wrdCat[u],d.innerText=__wrdCat[u+1*p],l.style.display="block",o.style.display="block",i.style.display="block",c.style.display="block",_.style.display="block",d.style.display="block",t?($("#instructions").html("<span>Este bloque es igual al anterior.</span><br>"),$("#instructions").append(e)):$("#instructions").html(e)}else if("word"==e){const e=a;__left=[__wrdLabel[u]],__right=[__wrdLabel[u+1*p]],i.innerText=__wrdCat[u],d.innerText=__wrdCat[u+1*p],i.style.display="block",d.style.display="block",$("#instructions").html(e)}else{if("img"!=e)throw"Invalid stageType";{const e=a;__left=[__imgLabel[__order]],__right=[__imgLabel[__order+1*g]],l.innerText=__imgCat[__order],c.innerText=__imgCat[__order+1*g],l.style.display="block",c.style.display="block",$("#instructions").html(e)}}}function hideText(e){var a=$("#leftColTxt"),t=$("#rightColTxt"),r=a.children("span")[0],n=a.children("span")[1],s=a.children("span")[2],l=t.children("span")[0],o=t.children("span")[1],i=t.children("span")[2],c=$("#rndCount"),_=$("#errorMrk"),d=$("#errorMsg");switch(e){case"columns":r.style.display="none",l.style.display="none",n.style.display="none",o.style.display="none",s.style.display="none",i.style.display="none";break;case"info":c.hide(),_.hide(),d.hide()}}function showInstructions(){switch(__instructions=!0,$("#space_bar").text("Presiona la barra espaciadora para comenzar"),__stage){case 1:assignLabelsAndText("word","<h1>Instrucciones:</h1><ul><li>Coloca tus dedos índices en las letras E y I de tu teclado.</li><li>Observa las palabras que aparecen en la parte superior de la pantalla, REPRESENTAN a las categorías que tendrás que ordenar. Las palabras o imágenes que tienes que ordenar aparecerán una por una en el centro de la pantalla.</li><li>Tu tarea será presionar la tecla E cuando la imagen o palabra pertenezca a la categoría del lado izquierdo. Cuando la palabra o la imagen pertenezca a la categoría de la derecha, presiona la tecla I.</li><li> Ojo: las imágenes o palabras sólo pertenecen a una categoría. Si cometes un error, aparecerá una X, para corregir el error presiona la tecla correcta tan rápido como puedas.</li><ul>",!1);break;case 2:assignLabelsAndText("img","",!1);break;case 3:case 4:assignLabelsAndText("word&img","",!1,!1);break;case 5:assignLabelsAndText("word","",!0),$("#instructions").append("<br><span>¡Aviso! el orden de las categorías (columnas) cambió de posición. Practica con esta nueva configuración.</span>");break;case 6:case 7:assignLabelsAndText("word&img","",!1,!0)}$("#space_bar").show(),$("#instructions").show(),$("#rndCount").show(),$("#blank").removeClass("blank_bigger"),$("#blank").addClass("blank")}function placeStimuli(e){const a=e.responseContent;__stageLength=a.length;for(let e=0;e<a.length;e++){const t=e+1,r=`#stimHolder_${t}`,n=a[e],s=n.type,l=n.label,o=n.content;$(r).removeClass("wrd"),$(r).hide(),"img"==s?$(r).html(`<img src='../imgs/stimuli/${o}.jpg'>`):($(r).html(o),$(r).addClass("wrd")),$(r).attr("label",l),$(r).attr("type",s),$(r).attr("val",o),$(".stimuli").imagesLoaded(function(){$("#loader").hide(),__trialCount=0,playIAT()})}}function playIAT(){const e=__trialCount+1;__trialCount<__stageLength?(0!=__trialCount&&$(`#stimHolder_${e-1}`).hide(),$(`#stimHolder_${e}`).show(),__trialStart=new Date,__errorCnt=0):($(`#stimHolder_${e-1}`).hide(),__stage+=1,IATloop())}function IATloop(){if($("#loader").hide(),__stage>7){const e={results:__results,order:__order};myAPI.endPoints.POST_results(e),window.location.href="/IAT/static/src/survey.php"}else 1==__stage&&(__order=randomInt(0,1));var e=[];__results[`round_${__stage}`]=e,$("#rndCount").text(`Ronda ${__stage} de 7`),hideText("columns"),hideText("info"),showInstructions()}var __order,__trialCount,__stageLength,__trialStart,__left,__right,myAPI,__stage=1,__imgCat=["Piel clara","Piel oscura"],__imgCatInstructions=["piel clara","piel oscura"],__wrdCat=["Bueno","Malo"],__wrdCatInstructions=["palabras buenas","palabras malas"],__imgLabel=["white","dark"],__wrdLabel=["good","bad"],__instructions=!1,__results={},__errorCnt=0;$(document).ready(function(){const e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,a=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,t=830,r=430;(e<r||a<t)&&alert("La resolución de tu dispositivo es muy pequeña para realizar esta prueba. Por favor, trata de hacer más grande la pantalla o ajusta la resolución y recarga la página"),$("html,body").scrollTop(0),IATloop(),$(document).keypress(function(e){e.preventDefault(),keyHandler(e,!1,keyCallBack)})});